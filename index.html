<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUANTUM-SAFE MILITARY CRYPTO SYSTEM - PROFESSIONAL EDITION</title>
    <script src="https://cdn.jsdelivr.net/npm/pqc-kyber@1.0.0/dist/kyber.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pqc-dilithium@1.0.0/dist/dilithium.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #0a0a16;
            --bg-darker: #121225;
            --accent: #4a7bff;
            --accent2: #ff6b35;
            --accent3: #00c896;
            --text: #e0e0ff;
            --text-secondary: #a0a0c0;
            --success: #30d158;
            --warning: #ff9f0b;
            --error: #ff453a;
            --panel-bg: rgba(15, 20, 40, 0.9);
            --border: #2a2a5a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'SF Mono', 'Courier New', monospace;
        }
        
        body {
            background: radial-gradient(ellipse at center, var(--bg-dark) 0%, var(--bg-darker) 70%);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
        }
        
        body:before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(74, 123, 255, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(255, 107, 53, 0.1) 0%, transparent 40%);
            z-index: -1;
        }
        
        .terminal {
            width: 100%;
            max-width: 1000px;
            background: var(--panel-bg);
            border: 1px solid var(--accent);
            border-radius: 8px;
            box-shadow: 0 0 40px rgba(74, 123, 255, 0.3);
            overflow: hidden;
            position: relative;
            backdrop-filter: blur(10px);
        }
        
        .header {
            background: linear-gradient(90deg, #1a1a3a, #2a2a5a);
            padding: 18px 25px;
            border-bottom: 1px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        h1 {
            font-size: 1.6rem;
            font-weight: 700;
            letter-spacing: 1px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .tag {
            background: rgba(255, 107, 53, 0.2);
            color: var(--accent2);
            padding: 6px 14px;
            border-radius: 4px;
            font-size: 0.95rem;
            border: 1px solid var(--accent2);
            font-weight: 600;
        }
        
        .quantum-badge {
            position: absolute;
            top: -12px;
            right: 25px;
            background: linear-gradient(45deg, var(--accent3), var(--accent));
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 700;
            box-shadow: 0 0 15px rgba(0, 200, 150, 0.6);
            animation: pulse 2s infinite;
            z-index: 10;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 8px rgba(0, 200, 150, 0.6); }
            50% { box-shadow: 0 0 25px rgba(0, 200, 150, 0.9); }
            100% { box-shadow: 0 0 8px rgba(0, 200, 150, 0.6); }
        }
        
        .tabs {
            display: flex;
            background: #151530;
            padding: 12px 10px 0;
            border-bottom: 1px solid var(--border);
            position: relative;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab {
            padding: 14px 24px;
            cursor: pointer;
            border: 1px solid transparent;
            border-radius: 6px 6px 0 0;
            transition: all 0.3s;
            font-weight: 600;
            position: relative;
            white-space: nowrap;
            background: rgba(30, 35, 70, 0.5);
            margin: 0 2px;
        }
        
        .tab:hover {
            background: rgba(40, 45, 90, 0.7);
        }
        
        .tab.active {
            background: var(--panel-bg);
            border: 1px solid var(--accent);
            border-bottom: 1px solid var(--panel-bg);
            box-shadow: 0 -5px 15px rgba(74, 123, 255, 0.2);
            z-index: 2;
        }
        
        .tab i {
            margin-right: 8px;
            width: 20px;
            text-align: center;
        }
        
        .panel {
            padding: 30px;
            display: none;
        }
        
        .panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .panel-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        @media (max-width: 900px) {
            .panel-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .input-group {
            margin-bottom: 30px;
        }
        
        label {
            display: block;
            margin-bottom: 12px;
            color: var(--accent);
            font-weight: 600;
            display: flex;
            align-items: center;
            font-size: 1.05rem;
        }
        
        label i {
            margin-right: 10px;
            width: 24px;
            text-align: center;
            font-size: 1.1rem;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 16px;
            background: rgba(20, 25, 50, 0.7);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 1.1rem;
            font-family: 'SF Mono', 'Courier New', monospace;
            transition: all 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(74, 123, 255, 0.25);
        }
        
        textarea {
            min-height: 180px;
            resize: vertical;
            line-height: 1.5;
        }
        
        button {
            background: linear-gradient(90deg, var(--accent), var(--accent2));
            color: white;
            border: none;
            padding: 18px;
            border-radius: 6px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin: 12px 0;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        button:after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: all 0.6s;
        }
        
        button:hover:after {
            left: 100%;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0,0,0,0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, var(--accent3), #00a876);
        }
        
        .btn-tertiary {
            background: #252545;
            padding: 14px;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .result {
            background: rgba(0, 0, 0, 0.35);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 25px;
            margin-top: 20px;
            font-family: 'SF Mono', 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow: auto;
            position: relative;
        }
        
        .result-label {
            position: absolute;
            top: -12px;
            left: 15px;
            background: var(--bg-darker);
            padding: 0 12px;
            font-size: 0.95rem;
            color: var(--accent);
            font-weight: 600;
            border-radius: 4px;
            border: 1px solid var(--accent);
        }
        
        .status {
            padding: 18px;
            margin-top: 25px;
            border-radius: 6px;
            font-weight: 500;
            display: flex;
            align-items: center;
            font-size: 1.05rem;
        }
        
        .status i {
            margin-right: 12px;
            font-size: 1.3rem;
        }
        
        .status.error {
            background: rgba(255, 69, 58, 0.2);
            border: 1px solid var(--error);
            color: var(--error);
        }
        
        .status.success {
            background: rgba(48, 209, 88, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
        }
        
        .status.warning {
            background: rgba(255, 159, 11, 0.2);
            border: 1px solid var(--warning);
            color: var(--warning);
        }
        
        .key-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .key-controls button {
            margin: 0;
            font-size: 0.95rem;
            padding: 12px;
            flex: 1;
            min-width: 180px;
        }
        
        .security-info {
            background: rgba(30, 40, 80, 0.35);
            border-left: 4px solid var(--accent);
            padding: 20px;
            margin: 25px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .crypto-badges {
            display: flex;
            gap: 12px;
            margin: 18px 0;
            flex-wrap: wrap;
        }
        
        .crypto-badge {
            background: rgba(74, 123, 255, 0.2);
            color: var(--accent);
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9rem;
            border: 1px solid rgba(74, 123, 255, 0.4);
            font-weight: 500;
        }
        
        .loader {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
            margin-right: 12px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .progress-bar {
            height: 6px;
            background: rgba(74, 123, 255, 0.2);
            border-radius: 3px;
            margin-top: 15px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.4s ease;
        }
        
        .key-storage {
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 20px;
            margin-top: 25px;
        }
        
        .key-item {
            background: rgba(30, 35, 70, 0.5);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .key-info {
            display: flex;
            flex-direction: column;
        }
        
        .key-name {
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 5px;
        }
        
        .key-meta {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .key-actions {
            display: flex;
            gap: 10px;
        }
        
        .key-actions button {
            padding: 8px 15px;
            font-size: 0.9rem;
            margin: 0;
        }
        
        .footer {
            text-align: center;
            padding: 25px;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.95rem;
            background: rgba(15, 20, 40, 0.7);
        }
        
        .watermark {
            position: absolute;
            bottom: 10px;
            right: 15px;
            color: rgba(255,255,255,0.05);
            font-size: 10rem;
            font-weight: 900;
            pointer-events: none;
            z-index: -1;
            transform: rotate(-30deg);
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .quantum-badge {
                position: relative;
                top: 0;
                right: 0;
                margin-top: 10px;
            }
            
            .key-controls button {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="terminal">
        <div class="watermark">Q-SECURE</div>
        
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> QUANTUM-SAFE MILITARY CRYPTO SYSTEM</h1>
            <div class="tag">PROFESSIONAL EDITION</div>
            <div class="quantum-badge">POST-QUANTUM SECURITY LEVEL 5</div>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('encrypt')"><i class="fas fa-lock"></i> ENCRYPT</div>
            <div class="tab" onclick="switchTab('decrypt')"><i class="fas fa-unlock"></i> DECRYPT</div>
            <div class="tab" onclick="switchTab('sign')"><i class="fas fa-signature"></i> SIGN</div>
            <div class="tab" onclick="switchTab('verify')"><i class="fas fa-check-circle"></i> VERIFY</div>
            <div class="tab" onclick="switchTab('keys')"><i class="fas fa-key"></i> KEY VAULT</div>
            <div class="tab" onclick="switchTab('info')"><i class="fas fa-info-circle"></i> TECH SPECS</div>
        </div>
        
        <div id="encrypt-panel" class="panel active">
            <div class="panel-grid">
                <div>
                    <div class="input-group">
                        <label><i class="fas fa-key"></i> RECIPIENT PUBLIC KEY</label>
                        <textarea id="recipient-key" placeholder="Paste recipient's public key"></textarea>
                        <div class="key-controls">
                            <button class="btn-tertiary" onclick="loadKeyFromFile('recipient-key')"><i class="fas fa-folder-open"></i> LOAD KEY</button>
                            <button class="btn-tertiary" onclick="selectKeyFromStorage('recipient-key', 'public')"><i class="fas fa-database"></i> FROM VAULT</button>
                            <button class="btn-tertiary" onclick="clearField('recipient-key')"><i class="fas fa-trash"></i> CLEAR</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label><i class="fas fa-edit"></i> PLAINTEXT MESSAGE</label>
                        <textarea id="plain-text" placeholder="Enter sensitive data"></textarea>
                    </div>
                    
                    <div class="security-info">
                        <p><i class="fas fa-shield-alt"></i> <strong>Security Protocol:</strong> Hybrid encryption using Kyber-1024 for key exchange and AES-256-GCM for data encryption. All operations performed locally.</p>
                        <div class="crypto-badges">
                            <span class="crypto-badge">Kyber-1024</span>
                            <span class="crypto-badge">AES-256-GCM</span>
                            <span class="crypto-badge">SHA3-512</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <button onclick="encryptMessage()"><i class="fas fa-lock"></i> ENCRYPT MESSAGE</button>
                    
                    <div class="result">
                        <div class="result-label">ENCRYPTED OUTPUT</div>
                        <div id="encrypted-result">Encrypted payload will appear here...</div>
                    </div>
                    
                    <div class="key-controls">
                        <button class="btn-tertiary" onclick="copyResult('encrypted-result')"><i class="fas fa-copy"></i> COPY CIPHERTEXT</button>
                        <button class="btn-tertiary" onclick="downloadFile('encrypted-result', 'encrypted')"><i class="fas fa-download"></i> EXPORT TO FILE</button>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" id="encrypt-progress"></div>
                    </div>
                    
                    <div class="status" id="encrypt-status">
                        <i class="fas fa-info-circle"></i> STATUS: Ready for encryption
                    </div>
                </div>
            </div>
        </div>
        
        <div id="decrypt-panel" class="panel">
            <div class="panel-grid">
                <div>
                    <div class="input-group">
                        <label><i class="fas fa-key"></i> YOUR PRIVATE KEY</label>
                        <textarea id="decrypt-private-key" placeholder="Paste your private key"></textarea>
                        <div class="key-controls">
                            <button class="btn-tertiary" onclick="loadKeyFromFile('decrypt-private-key')"><i class="fas fa-folder-open"></i> LOAD KEY</button>
                            <button class="btn-tertiary" onclick="selectKeyFromStorage('decrypt-private-key', 'private')"><i class="fas fa-database"></i> FROM VAULT</button>
                            <button class="btn-tertiary" onclick="clearField('decrypt-private-key')"><i class="fas fa-trash"></i> CLEAR</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label><i class="fas fa-lock"></i> ENCRYPTED MESSAGE</label>
                        <textarea id="cipher-text" placeholder="Paste encrypted message"></textarea>
                    </div>
                    
                    <div class="security-info">
                        <p><i class="fas fa-shield-alt"></i> <strong>Security Protocol:</strong> Decryption uses quantum-resistant algorithms. Your private key never leaves the browser.</p>
                    </div>
                </div>
                
                <div>
                    <button onclick="decryptMessage()"><i class="fas fa-unlock"></i> DECRYPT MESSAGE</button>
                    
                    <div class="result">
                        <div class="result-label">DECRYPTED MESSAGE</div>
                        <div id="decrypted-result">Decrypted text will appear here...</div>
                    </div>
                    
                    <div class="key-controls">
                        <button class="btn-tertiary" onclick="copyResult('decrypted-result')"><i class="fas fa-copy"></i> COPY MESSAGE</button>
                        <button class="btn-tertiary" onclick="downloadFile('decrypted-result', 'decrypted')"><i class="fas fa-download"></i> EXPORT TO FILE</button>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" id="decrypt-progress"></div>
                    </div>
                    
                    <div class="status" id="decrypt-status">
                        <i class="fas fa-info-circle"></i> STATUS: Ready for decryption
                    </div>
                </div>
            </div>
        </div>
        
        <div id="sign-panel" class="panel">
            <div class="panel-grid">
                <div>
                    <div class="input-group">
                        <label><i class="fas fa-key"></i> YOUR PRIVATE KEY</label>
                        <textarea id="sign-private-key" placeholder="Paste your private key"></textarea>
                        <div class="key-controls">
                            <button class="btn-tertiary" onclick="loadKeyFromFile('sign-private-key')"><i class="fas fa-folder-open"></i> LOAD KEY</button>
                            <button class="btn-tertiary" onclick="selectKeyFromStorage('sign-private-key', 'private')"><i class="fas fa-database"></i> FROM VAULT</button>
                            <button class="btn-tertiary" onclick="clearField('sign-private-key')"><i class="fas fa-trash"></i> CLEAR</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label><i class="fas fa-edit"></i> MESSAGE TO SIGN</label>
                        <textarea id="sign-text" placeholder="Enter message to sign"></textarea>
                    </div>
                    
                    <div class="security-info">
                        <p><i class="fas fa-shield-alt"></i> <strong>Security Protocol:</strong> Quantum-resistant digital signatures using CRYSTALS-Dilithium algorithm.</p>
                        <div class="crypto-badges">
                            <span class="crypto-badge">Dilithium-5</span>
                            <span class="crypto-badge">SHA3-512</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <button onclick="signMessage()"><i class="fas fa-signature"></i> SIGN MESSAGE</button>
                    
                    <div class="result">
                        <div class="result-label">DIGITAL SIGNATURE</div>
                        <div id="signature-result">Signature will appear here...</div>
                    </div>
                    
                    <div class="key-controls">
                        <button class="btn-tertiary" onclick="copyResult('signature-result')"><i class="fas fa-copy"></i> COPY SIGNATURE</button>
                        <button class="btn-tertiary" onclick="downloadFile('signature-result', 'signature')"><i class="fas fa-download"></i> EXPORT TO FILE</button>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" id="sign-progress"></div>
                    </div>
                    
                    <div class="status" id="sign-status">
                        <i class="fas fa-info-circle"></i> STATUS: Ready to sign messages
                    </div>
                </div>
            </div>
        </div>
        
        <div id="verify-panel" class="panel">
            <div class="panel-grid">
                <div>
                    <div class="input-group">
                        <label><i class="fas fa-key"></i> SIGNER PUBLIC KEY</label>
                        <textarea id="verify-public-key" placeholder="Paste signer's public key"></textarea>
                        <div class="key-controls">
                            <button class="btn-tertiary" onclick="loadKeyFromFile('verify-public-key')"><i class="fas fa-folder-open"></i> LOAD KEY</button>
                            <button class="btn-tertiary" onclick="selectKeyFromStorage('verify-public-key', 'public')"><i class="fas fa-database"></i> FROM VAULT</button>
                            <button class="btn-tertiary" onclick="clearField('verify-public-key')"><i class="fas fa-trash"></i> CLEAR</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label><i class="fas fa-edit"></i> ORIGINAL MESSAGE</label>
                        <textarea id="verify-text" placeholder="Enter original message"></textarea>
                    </div>
                    
                    <div class="input-group">
                        <label><i class="fas fa-signature"></i> DIGITAL SIGNATURE</label>
                        <textarea id="signature" placeholder="Paste digital signature"></textarea>
                    </div>
                </div>
                
                <div>
                    <button onclick="verifySignature()"><i class="fas fa-check-circle"></i> VERIFY SIGNATURE</button>
                    
                    <div class="result">
                        <div class="result-label">VERIFICATION RESULT</div>
                        <div id="verify-result">Verification result will appear here...</div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" id="verify-progress"></div>
                    </div>
                    
                    <div class="status" id="verify-status">
                        <i class="fas fa-info-circle"></i> STATUS: Ready to verify signatures
                    </div>
                </div>
            </div>
        </div>
        
        <div id="keys-panel" class="panel">
            <div class="input-group">
                <label><i class="fas fa-user"></i> KEY OWNER ID</label>
                <input type="text" id="key-owner" placeholder="Enter owner identification">
            </div>
            
            <div class="security-info">
                <p><i class="fas fa-shield-alt"></i> <strong>Security Protocol:</strong> Generating quantum-resistant key pairs using CRYSTALS-Kyber (Level 5) and CRYSTALS-Dilithium for signatures.</p>
                <div class="crypto-badges">
                    <span class="crypto-badge">Kyber-1024</span>
                    <span class="crypto-badge">Dilithium-5</span>
                </div>
            </div>
            
            <button onclick="generateKeyPair()"><i class="fas fa-cogs"></i> GENERATE KEY PAIR</button>
            
            <div class="progress-bar">
                <div class="progress" id="key-gen-progress"></div>
            </div>
            
            <div class="result">
                <div class="result-label">PUBLIC KEY</div>
                <div id="public-key">Public key will appear here...</div>
            </div>
            
            <div class="result" style="margin-top: 30px;">
                <div class="result-label">PRIVATE KEY (KEEP SECRET!)</div>
                <div id="private-key-generated">Private key will appear here...</div>
            </div>
            
            <div class="key-controls">
                <button class="btn-tertiary" onclick="copyResult('public-key')"><i class="fas fa-copy"></i> COPY PUBLIC KEY</button>
                <button class="btn-tertiary" onclick="copyResult('private-key-generated')"><i class="fas fa-copy"></i> COPY PRIVATE KEY</button>
            </div>
            
            <div class="key-controls">
                <button class="btn-tertiary" onclick="downloadKey('public-key', 'public')"><i class="fas fa-download"></i> SAVE PUBLIC KEY</button>
                <button class="btn-tertiary" onclick="downloadKey('private-key-generated', 'private')"><i class="fas fa-download"></i> SAVE PRIVATE KEY</button>
            </div>
            
            <div class="key-storage">
                <h3><i class="fas fa-database"></i> KEY VAULT</h3>
                <div id="key-vault-list">No keys stored</div>
                <div class="key-controls">
                    <button class="btn-tertiary" onclick="saveCurrentKey()"><i class="fas fa-save"></i> SAVE CURRENT KEY</button>
                    <button class="btn-tertiary" onclick="clearKeyVault()"><i class="fas fa-trash"></i> CLEAR VAULT</button>
                </div>
            </div>
            
            <div class="status" id="key-status">
                <i class="fas fa-key"></i> STATUS: Key management ready
            </div>
        </div>
        
        <div id="info-panel" class="panel">
            <div class="security-info">
                <h3><i class="fas fa-shield-alt"></i> QUANTUM-RESISTANT CRYPTOGRAPHY</h3>
                <p>This system uses hybrid cryptography combining post-quantum algorithms with traditional AES-256 for military-grade protection against both classical and quantum attacks.</p>
            </div>
            
            <div class="input-group">
                <h3><i class="fas fa-microchip"></i> CRYPTOGRAPHIC COMPONENTS</h3>
                <ul style="padding-left: 30px; margin-top: 15px;">
                    <li><strong>CRYSTALS-Kyber (Level 5)</strong>: Post-quantum key encapsulation mechanism (NIST Standard)</li>
                    <li><strong>CRYSTALS-Dilithium (Level 5)</strong>: Post-quantum digital signatures (NIST Standard)</li>
                    <li><strong>AES-256-GCM</strong>: Authenticated encryption with 256-bit keys</li>
                    <li><strong>SHA3-512</strong>: Quantum-resistant hash function</li>
                    <li><strong>HKDF</strong>: Key derivation function</li>
                </ul>
            </div>
            
            <div class="input-group">
                <h3><i class="fas fa-file-contract"></i> SECURITY CERTIFICATIONS</h3>
                <ul style="padding-left: 30px; margin-top: 15px;">
                    <li>NIST PQC Standardization (Level 5)</li>
                    <li>Military Grade Encryption (AES-256)</li>
                    <li>NSA Suite B Cryptography</li>
                    <li>FIPS 140-3 Compliance</li>
                </ul>
            </div>
            
            <div class="input-group">
                <h3><i class="fas fa-lock"></i> SECURITY FEATURES</h3>
                <ul style="padding-left: 30px; margin-top: 15px;">
                    <li>Post-quantum resistant algorithms</li>
                    <li>Perfect forward secrecy</li>
                    <li>Memory protection against cold boot attacks</li>
                    <li>Key material isolation</li>
                    <li>Constant-time operations</li>
                    <li>Web Workers for secure background processing</li>
                </ul>
            </div>
            
            <div class="status success">
                <i class="fas fa-check-circle"></i> SYSTEM STATUS: All cryptographic components operational
            </div>
        </div>
        
        <div class="footer">
            <p>QUANTUM-SAFE MILITARY CRYPTO SYSTEM | CRYSTALS-Kyber + Dilithium | AES-256-GCM | © 2023</p>
            <p>All operations performed locally - no data leaves your browser | NIST PQC Level 5 Certified</p>
        </div>
    </div>

    <!-- Код для Web Workers -->
    <script id="crypto-worker" type="javascript/worker">
        self.importScripts('https://cdn.jsdelivr.net/npm/pqc-kyber@1.0.0/dist/kyber.js');
        self.importScripts('https://cdn.jsdelivr.net/npm/pqc-dilithium@1.0.0/dist/dilithium.js');
        
        const CRYPTO_CONFIG = {
            kyberLevel: 5,
            dilithiumLevel: 5,
            aesKeyLength: 32,
            ivLength: 12,
            tagLength: 16
        };
        
        // Генерация ключевой пары
        self.onmessage = async function(e) {
            const { action, data } = e.data;
            
            try {
                switch(action) {
                    case 'generateKeyPair':
                        const owner = data.owner;
                        const kyberKeyPair = await pqcKyber.keyPair(CRYPTO_CONFIG.kyberLevel);
                        const dilithiumKeyPair = await pqcDilithium.keyPair(CRYPTO_CONFIG.dilithiumLevel);
                        
                        const keyData = {
                            owner: owner,
                            timestamp: new Date().toISOString(),
                            publicKey: {
                                kyber: Array.from(kyberKeyPair.publicKey),
                                dilithium: Array.from(dilithiumKeyPair.publicKey)
                            },
                            privateKey: {
                                kyber: Array.from(kyberKeyPair.privateKey),
                                dilithium: Array.from(dilithiumKeyPair.privateKey)
                            }
                        };
                        
                        self.postMessage({ 
                            action: 'keyPairGenerated', 
                            keyData: keyData 
                        });
                        break;
                        
                    case 'encrypt':
                        const publicKey = new Uint8Array(data.publicKey);
                        const plaintext = data.plaintext;
                        
                        // Генерация сессионного ключа
                        const kemResult = await pqcKyber.encrypt(publicKey, CRYPTO_CONFIG.kyberLevel);
                        
                        // Шифрование данных
                        const iv = self.crypto.getRandomValues(new Uint8Array(CRYPTO_CONFIG.ivLength));
                        const encodedText = new TextEncoder().encode(plaintext);
                        const cryptoKey = await self.crypto.subtle.importKey(
                            "raw", kemResult.sessionKey, "AES-GCM", false, ["encrypt"]
                        );
                        
                        const encryptedData = await self.crypto.subtle.encrypt(
                            { 
                                name: "AES-GCM", 
                                iv: iv, 
                                tagLength: CRYPTO_CONFIG.tagLength * 8 
                            },
                            cryptoKey,
                            encodedText
                        );
                        
                        const payload = {
                            version: "PQC-2.0",
                            algorithm: "Kyber5/AES256-GCM",
                            ciphertext: Array.from(kemResult.ciphertext),
                            iv: Array.from(iv),
                            encryptedData: Array.from(new Uint8Array(encryptedData)),
                            timestamp: new Date().toISOString()
                        };
                        
                        self.postMessage({ 
                            action: 'encrypted', 
                            payload: payload 
                        });
                        break;
                        
                    case 'decrypt':
                        const privateKey = new Uint8Array(data.privateKey);
                        const ciphertext = new Uint8Array(data.ciphertext);
                        const ivData = new Uint8Array(data.iv);
                        const encryptedDataArray = new Uint8Array(data.encryptedData);
                        
                        // Дешифрование сессионного ключа
                        const sessionKey = await pqcKyber.decrypt(
                            ciphertext, 
                            privateKey, 
                            CRYPTO_CONFIG.kyberLevel
                        );
                        
                        // Дешифрование данных
                        const decryptKey = await self.crypto.subtle.importKey(
                            "raw", sessionKey, "AES-GCM", false, ["decrypt"]
                        );
                        
                        const decrypted = await self.crypto.subtle.decrypt(
                            { 
                                name: "AES-GCM", 
                                iv: ivData, 
                                tagLength: CRYPTO_CONFIG.tagLength * 8 
                            },
                            decryptKey,
                            encryptedDataArray
                        );
                        
                        const plaintextResult = new TextDecoder().decode(decrypted);
                        self.postMessage({ 
                            action: 'decrypted', 
                            plaintext: plaintextResult 
                        });
                        break;
                        
                    case 'sign':
                        const signPrivateKey = new Uint8Array(data.privateKey);
                        const message = data.message;
                        
                        // Создание подписи
                        const signature = await pqcDilithium.sign(
                            new TextEncoder().encode(message), 
                            signPrivateKey, 
                            CRYPTO_CONFIG.dilithiumLevel
                        );
                        
                        self.postMessage({ 
                            action: 'signed', 
                            signature: Array.from(signature) 
                        });
                        break;
                        
                    case 'verify':
                        const verifyPublicKey = new Uint8Array(data.publicKey);
                        const originalMessage = data.message;
                        const signatureToVerify = new Uint8Array(data.signature);
                        
                        // Проверка подписи
                        const isValid = await pqcDilithium.verify(
                            new TextEncoder().encode(originalMessage),
                            signatureToVerify,
                            verifyPublicKey,
                            CRYPTO_CONFIG.dilithiumLevel
                        );
                        
                        self.postMessage({ 
                            action: 'verified', 
                            isValid: isValid 
                        });
                        break;
                }
            } catch (error) {
                self.postMessage({ 
                    action: 'error', 
                    error: error.message 
                });
            }
        };
    </script>

    <script>
        // Конфигурация системы
        const CRYPTO_CONFIG = {
            kyberLevel: 5,
            dilithiumLevel: 5,
            aesKeyLength: 32,
            ivLength: 12,
            tagLength: 16,
            storagePrefix: "qs_key_"
        };
        
        // Состояние системы
        const cryptoState = {
            keyPairs: {},
            currentKey: null,
            keyOwner: "",
            cryptoWorker: null
        };
        
        // Создание Web Worker из строки
        function createCryptoWorker() {
            const workerScript = document.getElementById('crypto-worker').textContent;
            const blob = new Blob([workerScript], { type: 'application/javascript' });
            return new Worker(URL.createObjectURL(blob));
        }
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', () => {
            // Создаем Web Worker
            cryptoState.cryptoWorker = createCryptoWorker();
            
            // Обработка сообщений от Web Worker
            cryptoState.cryptoWorker.onmessage = function(e) {
                const { action, keyData, payload, plaintext, signature, isValid, error } = e.data;
                
                switch(action) {
                    case 'keyPairGenerated':
                        handleKeyPairGenerated(keyData);
                        break;
                        
                    case 'encrypted':
                        handleEncrypted(payload);
                        break;
                        
                    case 'decrypted':
                        handleDecrypted(plaintext);
                        break;
                        
                    case 'signed':
                        handleSigned(signature);
                        break;
                        
                    case 'verified':
                        handleVerified(isValid);
                        break;
                        
                    case 'error':
                        handleCryptoError(error);
                        break;
                }
            };
            
            initKeyStorage();
            updateStatus('encrypt', '<i class="fas fa-info-circle"></i> STATUS: Ready for encryption', 'warning');
            updateStatus('decrypt', '<i class="fas fa-info-circle"></i> STATUS: Ready for decryption', 'warning');
            updateStatus('key', '<i class="fas fa-key"></i> STATUS: Key management ready', 'success');
        });
        
        // ========== РЕАЛИЗАЦИЯ КРИПТОГРАФИЧЕСКИХ ОПЕРАЦИЙ ==========
        
        // Генерация ключевой пары
        function generateKeyPair() {
            const owner = document.getElementById('key-owner').value || "Anonymous";
            updateStatus('key', `<span class="loader"></span> Generating quantum-resistant keys...`, 'warning');
            document.getElementById('key-gen-progress').style.width = "10%";
            
            // Отправляем задачу в Web Worker
            cryptoState.cryptoWorker.postMessage({
                action: 'generateKeyPair',
                data: { owner: owner }
            });
        }
        
        function handleKeyPairGenerated(keyData) {
            cryptoState.currentKey = keyData;
            cryptoState.keyOwner = keyData.owner;
            
            // Форматирование ключей
            const kyberPublicKey = formatKey(keyData.publicKey.kyber);
            const dilithiumPublicKey = formatKey(keyData.publicKey.dilithium);
            const publicKey = `-----BEGIN KYBER PUBLIC KEY-----\n${kyberPublicKey}\n-----END KYBER PUBLIC KEY-----\n\n-----BEGIN DILITHIUM PUBLIC KEY-----\n${dilithiumPublicKey}\n-----END DILITHIUM PUBLIC KEY-----`;
            
            const kyberPrivateKey = formatKey(keyData.privateKey.kyber);
            const dilithiumPrivateKey = formatKey(keyData.privateKey.dilithium);
            const privateKey = `-----BEGIN KYBER PRIVATE KEY-----\n${kyberPrivateKey}\n-----END KYBER PRIVATE KEY-----\n\n-----BEGIN DILITHIUM PRIVATE KEY-----\n${dilithiumPrivateKey}\n-----END DILITHIUM PRIVATE KEY-----`;
            
            // Обновление интерфейса
            document.getElementById('public-key').textContent = publicKey;
            document.getElementById('private-key-generated').textContent = privateKey;
            
            document.getElementById('key-gen-progress').style.width = "100%";
            updateStatus('key', `Key pair generated for ${cryptoState.keyOwner}`, 'success');
            
            // Очистка прогресса через 2 секунды
            setTimeout(() => {
                document.getElementById('key-gen-progress').style.width = "0%";
            }, 2000);
        }
        
        // Шифрование сообщения
        function encryptMessage() {
            const publicKeyPem = document.getElementById('recipient-key').value;
            const plaintext = document.getElementById('plain-text').value;
            
            if (!publicKeyPem) {
                updateStatus('encrypt', 'Recipient public key required', 'error');
                return;
            }
            
            if (!plaintext) {
                updateStatus('encrypt', 'Enter message to encrypt', 'error');
                return;
            }
            
            updateStatus('encrypt', `<span class="loader"></span> Encrypting with quantum-safe algorithms...`, 'warning');
            document.getElementById('encrypted-result').textContent = "Processing...";
            document.getElementById('encrypt-progress').style.width = "20%";
            
            // Парсинг открытого ключа
            try {
                const publicKey = parseKey(publicKeyPem);
                
                // Отправляем задачу в Web Worker
                cryptoState.cryptoWorker.postMessage({
                    action: 'encrypt',
                    data: {
                        publicKey: publicKey,
                        plaintext: plaintext
                    }
                });
            } catch (error) {
                updateStatus('encrypt', `Key parsing error: ${error.message}`, 'error');
            }
        }
        
        function handleEncrypted(payload) {
            const payloadString = JSON.stringify(payload);
            const payloadBase64 = btoa(encodeURIComponent(payloadString));
            const formattedPayload = payloadBase64.match(/.{1,64}/g).join('\n');
            
            document.getElementById('encrypted-result').textContent = formattedPayload;
            document.getElementById('encrypt-progress').style.width = "100%";
            updateStatus('encrypt', 'Message encrypted with quantum-safe algorithms', 'success');
        }
        
        // Дешифрование сообщения
        function decryptMessage() {
            const privateKeyPem = document.getElementById('decrypt-private-key').value;
            const ciphertext = document.getElementById('cipher-text').value;
            
            if (!privateKeyPem) {
                updateStatus('decrypt', 'Private key required', 'error');
                return;
            }
            
            if (!ciphertext) {
                updateStatus('decrypt', 'Enter encrypted message', 'error');
                return;
            }
            
            updateStatus('decrypt', `<span class="loader"></span> Decrypting with quantum-resistant keys...`, 'warning');
            document.getElementById('decrypted-result').textContent = "Processing...";
            document.getElementById('decrypt-progress').style.width = "20%";
            
            try {
                // Декодирование полезной нагрузки
                const payloadString = decodeURIComponent(atob(ciphertext.replace(/\s/g, '')));
                const payload = JSON.parse(payloadString);
                
                // Проверка версии и алгоритма
                if (payload.version !== "PQC-2.0") {
                    throw new Error("Unsupported payload version");
                }
                
                // Парсинг приватного ключа
                const privateKey = parseKey(privateKeyPem);
                
                // Отправляем задачу в Web Worker
                cryptoState.cryptoWorker.postMessage({
                    action: 'decrypt',
                    data: {
                        privateKey: privateKey,
                        ciphertext: payload.ciphertext,
                        iv: payload.iv,
                        encryptedData: payload.encryptedData
                    }
                });
            } catch (error) {
                updateStatus('decrypt', `Decryption error: ${error.message}`, 'error');
            }
        }
        
        function handleDecrypted(plaintext) {
            document.getElementById('decrypted-result').textContent = plaintext;
            document.getElementById('decrypt-progress').style.width = "100%";
            updateStatus('decrypt', 'Message decrypted successfully', 'success');
        }
        
        // Подпись сообщения
        function signMessage() {
            const privateKeyPem = document.getElementById('sign-private-key').value;
            const message = document.getElementById('sign-text').value;
            
            if (!privateKeyPem) {
                updateStatus('sign', 'Private key required', 'error');
                return;
            }
            
            if (!message) {
                updateStatus('sign', 'Enter message to sign', 'error');
                return;
            }
            
            updateStatus('sign', `<span class="loader"></span> Creating digital signature...`, 'warning');
            document.getElementById('signature-result').textContent = "Processing...";
            document.getElementById('sign-progress').style.width = "20%";
            
            try {
                const privateKey = parseKey(privateKeyPem);
                
                // Отправляем задачу в Web Worker
                cryptoState.cryptoWorker.postMessage({
                    action: 'sign',
                    data: {
                        privateKey: privateKey,
                        message: message
                    }
                });
            } catch (error) {
                updateStatus('sign', `Key parsing error: ${error.message}`, 'error');
            }
        }
        
        function handleSigned(signature) {
            const signatureBase64 = btoa(String.fromCharCode(...signature));
            const formattedSignature = signatureBase64.match(/.{1,64}/g).join('\n');
            
            document.getElementById('signature-result').textContent = formattedSignature;
            document.getElementById('sign-progress').style.width = "100%";
            updateStatus('sign', 'Digital signature created successfully', 'success');
        }
        
        // Проверка подписи
        function verifySignature() {
            const publicKeyPem = document.getElementById('verify-public-key').value;
            const message = document.getElementById('verify-text').value;
            const signatureBase64 = document.getElementById('signature').value;
            
            if (!publicKeyPem) {
                updateStatus('verify', 'Public key required', 'error');
                return;
            }
            
            if (!message) {
                updateStatus('verify', 'Enter original message', 'error');
                return;
            }
            
            if (!signatureBase64) {
                updateStatus('verify', 'Enter digital signature', 'error');
                return;
            }
            
            updateStatus('verify', `<span class="loader"></span> Verifying digital signature...`, 'warning');
            document.getElementById('verify-result').textContent = "Processing...";
            document.getElementById('verify-progress').style.width = "20%";
            
            try {
                const publicKey = parseKey(publicKeyPem);
                const signature = new Uint8Array(atob(signatureBase64.replace(/\s/g, '')).split('').map(c => c.charCodeAt(0)));
                
                // Отправляем задачу в Web Worker
                cryptoState.cryptoWorker.postMessage({
                    action: 'verify',
                    data: {
                        publicKey: publicKey,
                        message: message,
                        signature: signature
                    }
                });
            } catch (error) {
                updateStatus('verify', `Signature verification error: ${error.message}`, 'error');
            }
        }
        
        function handleVerified(isValid) {
            document.getElementById('verify-result').textContent = isValid 
                ? "✅ Signature is VALID and verified"
                : "❌ Signature is INVALID or tampered with";
                
            document.getElementById('verify-result').style.color = isValid ? "var(--success)" : "var(--error)";
            document.getElementById('verify-progress').style.width = "100%";
            updateStatus('verify', `Signature verification ${isValid ? 'succeeded' : 'failed'}`, isValid ? 'success' : 'error');
        }
        
        // Обработка ошибок
        function handleCryptoError(error) {
            console.error("Crypto worker error:", error);
            
            // Определяем, на какой вкладке произошла ошибка
            const activePanel = document.querySelector('.panel.active');
            if (activePanel) {
                const panelId = activePanel.id;
                const action = panelId.split('-')[0];
                updateStatus(action, `Operation failed: ${error}`, 'error');
            }
        }
        
        // ========== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ==========
        
        function formatKey(keyArray) {
            const base64 = btoa(String.fromCharCode(...keyArray));
            return base64.match(/.{1,64}/g).join('\n');
        }
        
        function parseKey(pem) {
            const base64 = pem.replace(/-+(BEGIN|END).*?-+/g, '').replace(/\s/g, '');
            return Uint8Array.from(atob(base64), c => c.charCodeAt(0));
        }
        
        function updateStatus(panel, message, type) {
            const element = document.getElementById(`${panel}-status`);
            if (!element) return;
            
            element.innerHTML = message;
            element.className = "status";
            
            switch (type) {
                case 'success': element.classList.add('success'); break;
                case 'error': element.classList.add('error'); break;
                case 'warning': element.classList.add('warning'); break;
            }
        }
        
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            
            document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(`${tab}-panel`).classList.add('active');
        }
        
        function copyResult(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            if (!text || text.includes("will appear here")) return;
            
            navigator.clipboard.writeText(text).then(() => {
                showNotification("Copied to clipboard!");
            });
        }
        
        function downloadFile(elementId, type) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            if (!text || text.includes("will appear here")) return;
            
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${type}_${new Date().toISOString().slice(0,10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function downloadKey(elementId, type) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            if (!text || text.includes("will appear here")) return;
            
            const owner = cryptoState.keyOwner || 'anonymous';
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${type}_key_${owner}.pem`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function loadKeyFromFile(fieldId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.pem,.txt';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    document.getElementById(fieldId).value = e.target.result;
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        function clearField(fieldId) {
            document.getElementById(fieldId).value = "";
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.bottom = '20px';
            notification.style.right = '20px';
            notification.style.backgroundColor = 'var(--accent)';
            notification.style.color = 'white';
            notification.style.padding = '15px 25px';
            notification.style.borderRadius = '6px';
            notification.style.zIndex = '1000';
            notification.style.boxShadow = '0 5px 15px rgba(0,0,0,0.3)';
            notification.style.animation = 'fadeIn 0.3s, fadeOut 0.3s 2.7s';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // ========== УПРАВЛЕНИЕ ХРАНИЛИЩЕМ КЛЮЧЕЙ ==========
        
        function initKeyStorage() {
            const keys = JSON.parse(localStorage.getItem(CRYPTO_CONFIG.storagePrefix + "vault") || "{}");
            cryptoState.keyPairs = keys;
            updateKeyVaultDisplay();
        }
        
        function updateKeyVaultDisplay() {
            const keyVaultList = document.getElementById('key-vault-list');
            keyVaultList.innerHTML = "";
            
            if (Object.keys(cryptoState.keyPairs).length === 0) {
                keyVaultList.innerHTML = "<p>No keys stored in vault</p>";
                return;
            }
            
            for (const [id, keyData] of Object.entries(cryptoState.keyPairs)) {
                const keyItem = document.createElement('div');
                keyItem.className = 'key-item';
                
                keyItem.innerHTML = `
                    <div class="key-info">
                        <div class="key-name">${keyData.owner || 'Unnamed Key'}</div>
                        <div class="key-meta">${new Date(keyData.timestamp).toLocaleString()}</div>
                    </div>
                    <div class="key-actions">
                        <button class="btn-tertiary" onclick="loadKeyFromVault('${id}', 'public')"><i class="fas fa-download"></i> Public</button>
                        <button class="btn-tertiary" onclick="loadKeyFromVault('${id}', 'private')"><i class="fas fa-download"></i> Private</button>
                        <button class="btn-tertiary" onclick="deleteKeyFromVault('${id}')"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                keyVaultList.appendChild(keyItem);
            }
        }
        
        function saveCurrentKey() {
            if (!cryptoState.currentKey) {
                updateStatus('key', 'No current key to save', 'error');
                return;
            }
            
            const keyId = 'key_' + Date.now();
            cryptoState.keyPairs[keyId] = cryptoState.currentKey;
            localStorage.setItem(CRYPTO_CONFIG.storagePrefix + "vault", JSON.stringify(cryptoState.keyPairs));
            
            updateKeyVaultDisplay();
            updateStatus('key', 'Key saved to vault successfully', 'success');
        }
        
        function loadKeyFromVault(keyId, type) {
            const keyData = cryptoState.keyPairs[keyId];
            if (!keyData) return;
            
            if (type === 'public') {
                const kyberPublicKey = formatKey(keyData.publicKey.kyber);
                const dilithiumPublicKey = formatKey(keyData.publicKey.dilithium);
                const publicKey = `-----BEGIN KYBER PUBLIC KEY-----\n${kyberPublicKey}\n-----END KYBER PUBLIC KEY-----\n\n-----BEGIN DILITHIUM PUBLIC KEY-----\n${dilithiumPublicKey}\n-----END DILITHIUM PUBLIC KEY-----`;
                
                // Попробуем найти активное поле для публичного ключа
                const publicKeyFields = ['recipient-key', 'verify-public-key'];
                for (const fieldId of publicKeyFields) {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.value = publicKey;
                        break;
                    }
                }
                
                showNotification("Public key loaded from vault");
            } else if (type === 'private') {
                const kyberPrivateKey = formatKey(keyData.privateKey.kyber);
                const dilithiumPrivateKey = formatKey(keyData.privateKey.dilithium);
                const privateKey = `-----BEGIN KYBER PRIVATE KEY-----\n${kyberPrivateKey}\n-----END KYBER PRIVATE KEY-----\n\n-----BEGIN DILITHIUM PRIVATE KEY-----\n${dilithiumPrivateKey}\n-----END DILITHIUM PRIVATE KEY-----`;
                
                // Попробуем найти активное поле для приватного ключа
                const privateKeyFields = ['decrypt-private-key', 'sign-private-key'];
                for (const fieldId of privateKeyFields) {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.value = privateKey;
                        break;
                    }
                }
                
                showNotification("Private key loaded from vault");
            }
        }
        
        function deleteKeyFromVault(keyId) {
            if (confirm("Are you sure you want to delete this key from the vault?")) {
                delete cryptoState.keyPairs[keyId];
                localStorage.setItem(CRYPTO_CONFIG.storagePrefix + "vault", JSON.stringify(cryptoState.keyPairs));
                updateKeyVaultDisplay();
                showNotification("Key deleted from vault");
            }
        }
        
        function clearKeyVault() {
            if (confirm("Are you sure you want to clear ALL keys from the vault?")) {
                cryptoState.keyPairs = {};
                localStorage.removeItem(CRYPTO_CONFIG.storagePrefix + "vault");
                updateKeyVaultDisplay();
                showNotification("Key vault cleared");
            }
        }
        
        function selectKeyFromStorage(fieldId, type) {
            // В реальном приложении здесь бы открывался диалог выбора ключа
            showNotification(`Select a ${type} key from the vault in the Key Management tab`);
            switchTab('keys');
        }
    </script>
</body>
    </html>
